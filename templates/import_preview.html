{% extends "base.html" %}
{% block title %}Preview Import - {{ item_type }} - KBM{% endblock %}

{% block content %}
<div class="form-shell">
  <div class="page-header">
    <h1>Preview Import - {{ item_type }}</h1>
    <p class="muted">Review the data before importing</p>
  </div>

  <div class="card form-card">
    <div class="info-box" style="margin-bottom: 20px; padding: 15px; background: rgba(251, 191, 36, 0.08); border-radius: 8px;">
      <p style="margin: 0;"><strong>Ready to import {{ total_rows }} rows</strong></p>
      <p style="margin: 5px 0 0 0;">Review the preview below. Click "Import Now" to proceed.</p>
    </div>

    <h3>Mapped Fields</h3>
    <div class="field-mapping-summary" style="margin-bottom: 30px; padding: 15px; background: #f9f9f9; border-radius: 8px;">
      <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 10px;">
        {% for field_name, column in mapping.items() %}
          <div style="padding: 8px; background: white; border-radius: 4px; border: 1px solid #e0e0e0;">
            <strong>{{ fields[field_name].name }}:</strong>
            <span class="muted">{{ column }}</span>
          </div>
        {% endfor %}
      </div>
    </div>

    <h3>Preview (First 10 Rows)</h3>
    <div style="overflow-x: auto; margin-bottom: 20px;">
      <table class="preview-table" style="width: 100%; border-collapse: collapse;">
        <thead>
          <tr style="background: #f5f5f5;">
            {% for field_name in mapping.keys() %}
              <th style="padding: 10px; border: 1px solid #ddd; text-align: left;">
                {{ fields[field_name].name }}
                {% if fields[field_name].required %}<span style="color: var(--color-danger);">*</span>{% endif %}
              </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for item in preview_data %}
            <tr>
              {% for field_name in mapping.keys() %}
                <td style="padding: 10px; border: 1px solid #ddd;">
                  {{ item.get(field_name, '') if item.get(field_name, '') else '-' }}
                </td>
              {% endfor %}
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

    {% if total_rows > 10 %}
      <p class="muted" style="margin-bottom: 20px;">
        Showing 10 of {{ total_rows }} rows. All rows will be imported.
      </p>
    {% endif %}

    <form method="post">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
      <div class="toolbar spaced">
        <button type="submit" class="btn primary">Import Now ({{ total_rows }} rows)</button>
        <a class="btn ghost" href="{{ url_for('inventory.import_keys_map') }}">Back to Mapping</a>
        <a class="btn ghost" href="{{ url_for('inventory.import_keys') }}">Start Over</a>
      </div>
    </form>
  </div>
</div>

<style>
  .field-mapping-summary {
    font-size: 14px;
  }
  .preview-table {
    font-size: 13px;
  }
</style>
{% endblock %}
