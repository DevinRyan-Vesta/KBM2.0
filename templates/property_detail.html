{% extends "base.html" %}
{% block title %}{{ property.name }} - Property{% endblock %}

{% block content %}
<div class="page-header">
  <div>
    <h1>{{ property.name }}</h1>
    <div class="muted">{{ property.address_line1 }}{% if property.city %}, {{ property.city }}{% endif %}{% if property.state %}, {{ property.state }}{% endif %}</div>
  </div>
  <div class="toolbar">
    <a class="btn" href="{{ url_for('properties.edit_property', property_id=property.id) }}">Edit</a>
    <a class="btn ghost" href="{{ url_for('properties.list_properties') }}">Back</a>
  </div>
</div>

<div class="grid cols-2" style="gap: 20px;">
  <div class="card">
    <h2>Property Details</h2>
    <div class="info-grid">
      <div class="info-item">
        <div class="info-label">Type</div>
        <div class="info-value">{{ (property.type or 'Unknown').replace('_',' ')|title }}</div>
      </div>
      <div class="info-item">
        <div class="info-label">Address</div>
        <div class="info-value">
          {{ property.address_line1 }}<br>
          {% if property.address_line2 %}{{ property.address_line2 }}<br>{% endif %}
          {{ property.city or '' }}{% if property.state %}, {{ property.state }}{% endif %} {{ property.postal_code or '' }}
        </div>
      </div>
      <div class="info-item">
        <div class="info-label">Country</div>
        <div class="info-value">{{ property.country or 'USA' }}</div>
      </div>
      <div class="info-item">
        <div class="info-label">Created</div>
        <div class="info-value">{{ property.created_at.strftime('%Y-%m-%d') if property.created_at else '-' }}</div>
      </div>
    </div>
    {% if property.notes %}
      <div class="divider"></div>
      <div class="info-item">
        <div class="info-label">Notes</div>
        <div class="info-value">{{ property.notes }}</div>
      </div>
    {% endif %}
  </div>

  <div class="card">
    <h2>Inventory Summary</h2>
    <ul class="stat-list">
      <li><strong>{{ item_totals['total'] }}</strong> total items linked</li>
      <li><strong>{{ item_totals['keys'] }}</strong> key(s)</li>
      <li><strong>{{ item_totals['lockboxes'] }}</strong> lockbox(es)</li>
      <li><strong>{{ item_totals['signs'] }}</strong> sign(s)</li>
    </ul>
  </div>
</div>

<div class="card" style="margin-top: 24px;">
  <h2>Linked Items</h2>
  {% if items %}
    <table>
      <thead>
        <tr>
          <th>Label</th>
          <th>Type</th>
          <th>Status</th>
          <th>Unit</th>
        </tr>
      </thead>
      <tbody>
        {% for item in items %}
          <tr>
            <td><a href="{{ url_for('inventory.item_details', item_id=item.id) }}">{{ item.label }}</a></td>
            <td>{{ item.type }}</td>
            <td>{{ item.status|replace('_',' ')|title }}</td>
            <td>{{ item.property_unit.label if item.property_unit else '-' }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <div class="empty-state">No items currently linked to this property.</div>
  {% endif %}
</div>

<div class="grid cols-2" style="gap: 20px; margin-top: 24px;">
  <div class="card">
    <h2>Units</h2>
    {% if units %}
      <table>
        <thead>
          <tr>
            <th>Label</th>
            <th>Bedrooms</th>
            <th>Bathrooms</th>
            <th>Sq Ft</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for unit in units %}
            <tr>
              <td><a href="{{ url_for('properties.unit_detail', property_id=property.id, unit_id=unit.id) }}">{{ unit.label }}</a></td>
              <td>{{ unit.bedrooms if unit.bedrooms is not none else '-' }}</td>
              <td>{{ unit.bathrooms if unit.bathrooms is not none else '-' }}</td>
              <td>{{ unit.square_feet if unit.square_feet is not none else '-' }}</td>
              <td>
                <a href="{{ url_for('properties.unit_detail', property_id=property.id, unit_id=unit.id) }}" class="btn small">View</a>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="empty-state">No units recorded for this property.</div>
    {% endif %}

    <form method="post" action="{{ url_for('properties.create_unit', property_id=property.id) }}" style="margin-top: 16px;">
      <h3 style="margin-bottom: 12px;">Add Unit</h3>
      <div class="form-grid two-column">
        <div class="form-field">
          <label for="label">Label *</label>
          <input type="text" id="label" name="label" placeholder="e.g., Unit 101" required>
        </div>
        <div class="form-field">
          <label for="floor">Floor</label>
          <input type="text" id="floor" name="floor" placeholder="e.g., 1">
        </div>
        <div class="form-field">
          <label for="bedrooms">Bedrooms</label>
          <input type="number" id="bedrooms" name="bedrooms" min="0">
        </div>
        <div class="form-field">
          <label for="bathrooms">Bathrooms</label>
          <input type="number" step="0.5" id="bathrooms" name="bathrooms" min="0">
        </div>
        <div class="form-field">
          <label for="square_feet">Square Feet</label>
          <input type="number" id="square_feet" name="square_feet" min="0">
        </div>
      </div>
      <div class="form-field">
        <label for="notes">Notes</label>
        <textarea id="notes" name="notes" rows="2"></textarea>
      </div>
      <button class="btn small" type="submit">Add Unit</button>
    </form>
  </div>

  <div class="card">
    <h2>Smart Locks</h2>
    {% if smart_locks %}
      <table>
        <thead>
          <tr>
            <th>Label</th>
            <th>Provider</th>
            <th>Code</th>
          </tr>
        </thead>
        <tbody>
          {% for lock in smart_locks %}
            <tr>
              <td><a href="{{ url_for('smartlocks.smartlock_detail', lock_id=lock.id) }}">{{ lock.label }}</a></td>
              <td>{{ lock.provider or '-' }}</td>
              <td>{{ lock.code }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <div class="empty-state">No smart locks linked to this property.</div>
    {% endif %}
    <a class="btn small" style="margin-top: 12px;" href="{{ url_for('smartlocks.create_smartlock') }}">Add Smart Lock</a>
  </div>
</div>
{% endblock %}

